!function(t,i,r,a){"use strict";var n=function(i){var r={box:null,data:{},change:function(){}},a=null,n=this;if(r=t.extend(!0,{},r,i||{}),a=r.box,!a[0])return alert("参数不正确！"),!1;var e={};e.attrItem=function(t){var i=t.gid?t.gid:"";return'<li class="item-event" data-gid="'+i+'" data-pid="'+t.pid+'" data-id="'+t.id+'" data-name="'+t.name+'"><a href="javascript:;">'+t.name+"<i></i></a></li>"},e.attrItems=function(i){var a="",n="";return t.each(i.list,function(){var t=arguments[1];t.gid=i.gid,t.pid=i.pid,n+=e.attrItem(t)}),a='<label class="title">'+i.name+'：</label><div class="attribute" data-name="'+i.name+'" data-pid="'+i.pid+'">    <ul>'+n+"</ul></div>",a=r.isGroups===!0?'<div class="item">'+a+"</div>":"<li>"+a+"</li>"},e.render=function(){var i="";if(r.isGroups===!0){var n=function(i){var r="";return t.each(i,function(){r+=e.attrItems(arguments[1])}),r};t.each(r.groups_order,function(t){var a=r.groups_map[arguments[1]],e=r.parms[a.gid]?n(r.parms[a.gid],t):"";i+='<li>    <div class="group">        <div class="group-img">            <a href="'+a.url+'"><img src="'+a.img+'"></a>        </div>        <div class="group-info">            <div class="group-title">               <span>'+(t+1)+".</span> "+a.name+'            </div>            <div class="group-items">'+e+"</div>        </div>    </div></li>"})}else t.each(r.data.parms,function(){i+=e.attrItems(arguments[1])});i="<ul>"+i+"</ul>",a.html(i)};var d=function(i){var r=[];return t.each(i,function(){var t=arguments[1],i=t.gid?t.gid+"|||":"";r.push(i+t.pid+"|||"+t.id)}),r.join(",")},s=function(t,i,a,n){t?(r.parms[t][i].checeked=n,n===!0?r.parms[t][i].checekedId=a:r.parms[t][i].checekedId=""):(r.parms[i].checeked=n,n===!0?r.parms[i].checekedId=a:r.parms[i].checekedId="")},c=function(t){var i=n.findProducts(t),r=!0;return null===i?r=!1:Number(i.stock)<1&&(r=!1),r},u=function(t){var i=t.length;if(i>=2){for(var r=t[0].length,a=t[1].length,n=r*a,e=new Array(n),d=0,s=0;s<r;s++)for(var c=0;c<a;c++)e[d]=t[0][s]+","+t[1][c],d++;for(var o=new Array(i-1),l=2;l<i;l++)o[l-1]=t[l];return o[0]=e,u(o)}return t[0]},o=function(i){var r=i.split(","),a=[];return t.each(r,function(){var t=arguments[1];a.push(t.split("|||"))}),a},l=function(t){var i=t.data("gid"),r=t.data("pid"),a=t.data("id");return i?[i,r,a]:[r,a]},p=function(){var i=a.find("li.item-event.checked"),r=[];return t.each(i,function(){r.push(l(t(this)))}),r},h=function(i,a){var n=null;if(a=a?a:[],i&&i.length>0){var e=3===i.length?r.parms[i[0]][i[1]].disabled:r.parms[i[0]].disabled,d=3===i.length?i[2]:i[1];if(t.inArray(d,e)>-1)n=!1;else{var l=[],p=[];t.each(a,function(){var t=arguments[1];3===t.length?s(t[0],t[1],t[2],!0):s(null,t[0],t[1],!0),p.push([arguments[1].join("|||")])}),p.push([i.join("|||")]);var h=0;t.each(r.parms,function(){var r=arguments[1];3===i.length?t.each(r,function(){var r=arguments[1];r.checeked!==!0&&(l[h]=[],t.each(r.list,function(){var t=arguments[1];return t.gid.toString()===i[0].toString()&&t.pid.toString()===i[1].toString()&&t.id.toString()===i[2].toString()?(l[h]=[],!1):(l[h]||(l[h]=[]),void l[h].push(t.gid+"|||"+t.pid+"|||"+t.id))}),l[h]&&l[h].length>0&&h++)}):r.checeked!==!0&&(t.each(r.list,function(){var t=arguments[1];return t.pid.toString()===i[0].toString()&&t.id.toString()===i[1].toString()?(l[h]=[],!1):(l[h]||(l[h]=[]),void l[h].push(t.pid+"|||"+t.id))}),l[h]&&l[h].length>0&&h++)}),t.each(l,function(){var t=arguments[1];t.length>0&&p.push(arguments[1])});var g=u(p),f=0;t.each(g,function(){var t=o(arguments[1]),i=c(t);i===!1&&f++}),n=f!==g.length}}return n},g=function(t){var i=3===t.length?'[data-gid="'+t[0]+'"][data-pid="'+t[1]+'"][data-id="'+t[2]+'"]':'[data-pid="'+t[0]+'"][data-id="'+t[1]+'"]',r=a.find("li"+i);return r},f=function(t,i){var r=g(t);1===r.length&&(i===!0?r.addClass("disabled"):r.removeClass("disabled"))},v=function(i,a,e){var d="",s="",c="",u=p(),o=n.getProductInfo(u),g=function(i,r){var a=t.extend(!0,[],[],u);return t.each(a,function(t,n){if(i){if(n[0].toString()===i.toString()&&n[1].toString()===r.toString())return a.splice(t,1),!1}else if(n[0].toString()===r.toString())return a.splice(t,1),!1}),a};3===i.length?(d=i[0].toString(),s=i[1].toString(),c=i[2].toString(),a===!0?r.parms[d][s].checeked=c:r.parms[d][s].checeked=""):(s=i[0].toString(),c=i[1].toString(),a===!0?r.parms[s].checeked=c:r.parms[s].checeked=""),t.each(r.data.parms,function(){var i=arguments[1];t.each(i.list,function(){var t=arguments[1],i=t.gid?t.gid:null,r=g(i,t.pid),a=t.gid?[t.gid,t.pid,t.id]:[t.pid,t.id],n=h(a,r);n===!1?f(a,!0):f(a,!1)})}),r.change&&t.isFunction(r.change)&&r.change(e,l(e),{checked:u,selected:o?o:n.filterProducts(u)})};this.init=function(){if(r.parms={},r.data.groups&&r.data.groups.length>0){r.isGroups=!0,r.groups_order=[],r.groups_map={};var i=[],n=function(a,n){0===i.length||a>=i[i.length-1]?(i.push(a),r.groups_order.push(n)):a<i[0]?(i.unshift(a),r.groups_order.unshift(n)):t.each(i,function(t,e){if(a<=e)return i.splice(t,0,a),r.groups_order.splice(t,0,n),!1})};t.each(r.data.groups,function(){var t=arguments[1],i=Number(t.sorts);n(i,t.gid),r.groups_map[t.gid]=t}),i=null,t.each(r.data.parms,function(){var t=arguments[1];r.parms[t.gid]||(r.parms[t.gid]={}),r.parms[t.gid][t.pid]=t})}else t.each(r.data.parms,function(){var t=arguments[1];r.parms[t.pid]||(r.parms[t.pid]={}),r.parms[t.pid]=t});e.render(),r.products={},t.each(r.data.products,function(t,i){var a=d(i.parms);r.products[a]=i,r.products[a].index=t}),t.each(r.data.parms,function(){var i=arguments[1];t.each(i.list,function(){var a=arguments[1],n=null;n=r.isGroups===!0?[i.gid,i.pid,a.id]:[i.pid,a.id];var e=h(n);e===!1&&(r.isGroups===!0?r.parms[n[0]][n[1]].disabled?t.inArray(n[2].toString(),r.parms[n[0]][n[1]].disabled)<0&&r.parms[n[0]][n[1]].disabled.push(n[2].toString()):r.parms[n[0]][n[1]].disabled=[n[2].toString()]:r.parms[n[0]].disabled?t.inArray(n[1].toString(),r.parms[n[0]].disabled)<0&&r.parms[n[0]].disabled.push(n[1].toString()):r.parms[n[0]].disabled=[n[1].toString()],f(n,!0))})}),a.on("click","li.item-event",function(){var i=t(this),r=null;if(!i.hasClass("disabled")){var a=l(i);i.hasClass("checked")?(i.removeClass("checked"),r=!1):(i.addClass("checked").siblings().removeClass("checked"),r=!0),v(a,r,i)}return!1}),0===r.data.parms.length&&1===r.data.products.length&&r.change&&t.isFunction(r.change)&&r.change(null,null,{checked:[],selected:r.data.products})},this.findProducts=function(i){var a=null,n=function(r){var a=0;return t.each(i,function(){var i=arguments[1],n=i.join("|||");t.inArray(n,r)>-1&&a++}),i.length===a};return t.each(r.products,function(t,i){var r=t.split(","),e=n(r);if(e)return a=i,!1}),a},this.filterProducts=function(i){var a=[];return t.each(r.products,function(r,n){var e=r.split(","),d=0;t.each(i,function(){var i=arguments[1];t.inArray(i.join("|||"),e)>-1&&d++}),d===i.length&&a.push(n)}),a},this.getProductInfo=function(){var t=p(),i=null;return t.length===r.data.parms_len&&(i=n.findProducts(t)),null===i&&0===r.data.parms_len&&1===r.data.products.length&&(i=r.data.products[0]),i}};t.es&&t.isPlainObject(t.es)||(t.es={}),t.es.ProductAttribute=n,t.fn.esProductAttribute=function(i){var r={box:this,data:{},change:function(){}},a=null;r=t.extend(!0,{},r,i||{}),a=new t.es.ProductAttribute(r),a.init()}}(jQuery,window,document);
